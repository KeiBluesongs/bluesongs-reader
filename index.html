<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Bluesongs Reader</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#111; --muted:#666; --bar:#f4f4f4; --border:#e5e5e5;
      --fontSize: 18px;
      --lineHeight: 1.9;
      --contentWidth: 42em;
      --fontFamily: -apple-system, system-ui, "Hiragino Kaku Gothic ProN", "Yu Gothic", "Noto Sans JP", sans-serif;
    }
    [data-theme="dark"]{
      --bg:#0f1115; --fg:#eaeef5; --muted:#a9b2c3; --bar:#161a22; --border:#2a3140;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: var(--fontFamily);
    }

    /* æŠ˜ã‚ŠãŸãŸã¿è¨­å®šãƒãƒ¼ */
    details#controls{
      position: sticky; top:0; z-index:10;
      background:var(--bar);
      border-bottom:1px solid var(--border);
    }
    details#controls > summary{
      list-style:none;
      cursor:pointer;
      padding:10px max(12px, env(safe-area-inset-left)) 10px max(12px, env(safe-area-inset-right));
      display:flex; gap:10px; align-items:center;
      user-select:none;
    }
    details#controls > summary::-webkit-details-marker{ display:none; }
    .summaryTitle{ font-weight:700; white-space:nowrap; }
    .summaryNow{
      color:var(--muted); font-size:12px; flex:1;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .summaryHint{ color:var(--muted); font-size:12px; white-space:nowrap; }

    .controlsInner{
      padding: 0 max(12px, env(safe-area-inset-left)) 12px max(12px, env(safe-area-inset-right));
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .group{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
    button, select, input[type="file"]{ font: inherit; }
    button, select{
      border:1px solid var(--border);
      background:var(--bg);
      color:var(--fg);
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
    }
    button:active{transform: translateY(1px)}
    .hint{color:var(--muted); font-size:12px}

    /* æœ¬æ–‡é ˜åŸŸ */
    main{
      height: calc(100% - 0px);
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding: 18px 14px 40px 14px;
      overscroll-behavior: contain;
    }
    .paper{
      margin: 0 auto;
      max-width: var(--contentWidth);
      font-size: var(--fontSize);
      line-height: var(--lineHeight);
      letter-spacing: 0.02em;
      white-space: normal;
      word-break: break-word;
    }
    .title{font-size:1.35em; font-weight:700; margin: 0 0 6px 0;}
    .author{color:var(--muted); margin:0 0 18px 0}
    p{margin: 0 0 0.9em 0;}
    hr{border:none; border-top:1px solid var(--border); margin: 18px 0;}
    ruby rt{font-size:0.6em; color:var(--muted)}
    .empty{
      color:var(--muted);
      border:1px dashed var(--border);
      border-radius:14px;
      padding:18px;
    }

    /* ç¸¦æ›¸ãï¼šæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§åˆ—é€ã‚Šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ */
    [data-writing="vertical"] main{
      overflow-x: auto;
      overflow-y: hidden;
      padding: 18px 10px 24px 10px;
      scroll-snap-type: x mandatory;      /* åˆ—é€ã‚Šã‚’â€œãƒšãƒ¼ã‚¸ã£ã½ãâ€ */
      scroll-behavior: smooth;
    }
    [data-writing="vertical"] .paper{
      writing-mode: vertical-rl;
      text-orientation: mixed;
      /* é‡è¦ï¼šé«˜ã•ã‚’ç”»é¢ã«åˆã‚ã›ã‚‹â†’ä¸‹ç«¯ã§æŠ˜ã‚Šè¿”ã—ã¦æ¬¡ã®åˆ—ã¸ */
      height: calc(100vh - 64px); /* summary+paddingã¶ã‚“ã®é›‘ãªè¦‹ç©ã‚‚ã‚Šã€‚JSã§å¾Œã§å¾®èª¿æ•´ */
      width: max-content;
      max-width: none;
      margin: 0;
      padding-inline: 10px;
    }
    [data-writing="vertical"] .paper > *{
      scroll-snap-align: start;
    }
    [data-writing="vertical"] p{margin: 0 0 1.2em 0;}
  </style>
</head>
<body data-theme="light" data-writing="horizontal">
  <details id="controls">
    <summary>
      <span class="summaryTitle">âš™ï¸ è¨­å®š</span>
      <span class="summaryNow" id="nowReading">æœªèª­</span>
      <span class="summaryHint" id="openHint">â–¼</span>
    </summary>

    <div class="controlsInner">
      <div class="group">
        <input id="file" type="file" accept=".txt,.text,.html,.htm" />
        <select id="encoding" title="æ–‡å­—ã‚³ãƒ¼ãƒ‰">
          <!-- åˆæœŸè¨­å®šï¼šShift_JISï¼ˆvalueã¯ shift-jis ãŒå®‰å®šï¼‰ -->
          <option value="shift-jis">Shift_JIS</option>
          <option value="utf-8">UTF-8</option>
        </select>

        <select id="font" title="ãƒ•ã‚©ãƒ³ãƒˆ">
          <option value="mincho">æ˜æœï¼ˆãŠã™ã™ã‚ï¼‰</option>
          <option value="gothic">ã‚´ã‚·ãƒƒã‚¯</option>
          <option value="serif">Serifï¼ˆæ±ç”¨ï¼‰</option>
        </select>

        <span class="hint">é’ç©ºæ–‡åº«txtã¯Shift_JISãŒå¤šã„</span>
      </div>

      <div class="group">
        <button id="smaller">A-</button>
        <button id="bigger">A+</button>
        <button id="lhDown">è¡Œé–“-</button>
        <button id="lhUp">è¡Œé–“+</button>
        <button id="theme">ğŸŒ™/â˜€ï¸</button>
        <button id="writing">ç¸¦/æ¨ª</button>
        <button id="resetView">è¡¨ç¤ºãƒªã‚»ãƒƒãƒˆ</button>
        <button id="resetLoad" title="èª­ã¿è¾¼ã¿çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢">èª­ã¿è¾¼ã¿ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>
  </details>

  <main id="scroller">
    <div class="paper" id="paper">
      <div class="empty">
        <div style="font-weight:700; margin-bottom:6px;">Bluesongs Reader</div>
        <div>ã€Œè¨­å®šã€â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶ã¨ã€é’ç©ºæ–‡åº«ã®ãƒ«ãƒ“ä»˜ããƒ†ã‚­ã‚¹ãƒˆã‚’èª­æ›¸ã‚¢ãƒ—ãƒªã£ã½ãèª­ã‚ã‚‹ã‚ˆã€‚</div>
        <div style="margin-top:10px;" class="hint">ãƒ«ãƒ“è¨˜æ³•ä¾‹ï¼šï½œæ¼¢å­—ã€Šã‹ã‚“ã˜ã€‹</div>
      </div>
    </div>
  </main>

<script>
(() => {
  const el = (id) => document.getElementById(id);

  const controls = el("controls");
  const nowReading = el("nowReading");
  const openHint = el("openHint");

  const fileInput = el("file");
  const encodingSel = el("encoding");
  const fontSel = el("font");

  const paper = el("paper");
  const scroller = el("scroller");

  const settingsKey = "bluesongs_reader_settings_v3";

  // â˜…èª­ã¿è¾¼ã¿æ¸ˆã¿ã®ãƒã‚¤ãƒˆåˆ—ã‚’ä¿æŒï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã§å†ãƒ‡ã‚³ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ï¼‰
  let lastFileBuf = null;     // ArrayBuffer
  let lastFileMeta = null;    // {name,size,lastModified}
  let lastDocId = null;
  let lastTitle = null;

  const state = {
    theme: "light",
    writing: "horizontal",
    fontSize: 18,
    lineHeight: 1.9,
    encoding: "shift-jis",   // â˜…åˆæœŸï¼šShift_JIS
    font: "mincho"           // â˜…åˆæœŸï¼šæ˜æœ
  };

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
  function escapeHtml(s){
    return s.replace(/[&<>"']/g, (c) => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
  }
  function setCssVars(){
    document.documentElement.style.setProperty("--fontSize", state.fontSize + "px");
    document.documentElement.style.setProperty("--lineHeight", state.lineHeight);

    // ãƒ•ã‚©ãƒ³ãƒˆ
    const stacks = {
      mincho: `"Hiragino Mincho ProN","YuMincho","Noto Serif JP","Hiragino Mincho Pro",serif`,
      gothic: `-apple-system, system-ui, "Hiragino Kaku Gothic ProN","Yu Gothic","Noto Sans JP",sans-serif`,
      serif: `ui-serif, "Times New Roman", Times, serif`
    };
    document.documentElement.style.setProperty("--fontFamily", stacks[state.font] || stacks.mincho);
  }
  function applyTheme(){ document.body.dataset.theme = state.theme; }
  function applyWriting(){
    document.body.dataset.writing = state.writing;
    // ç¸¦æ›¸ãã®é«˜ã•ã‚’ã€å®Ÿéš›ã®è¨­å®šãƒãƒ¼ã®é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´ï¼ˆã‚ˆã‚Šâ€œç”»é¢ã„ã£ã±ã„ã§æŠ˜ã‚Šè¿”ã—â€ï¼‰
    if(state.writing === "vertical"){
      requestAnimationFrame(() => {
        const controlsH = controls.getBoundingClientRect().height;
        const pad = 18; // main paddingã®é›°å›²æ°—åˆ†
        const h = Math.max(240, window.innerHeight - controlsH - pad);
        paper.style.height = h + "px";
      });
    } else {
      paper.style.height = "";
    }
  }
  function saveSettings(){
    localStorage.setItem(settingsKey, JSON.stringify({
      theme: state.theme,
      writing: state.writing,
      fontSize: state.fontSize,
      lineHeight: state.lineHeight,
      encoding: state.encoding,
      font: state.font,
      lastDocId,
      lastTitle
    }));
  }
  function loadSettings(){
    try{
      const raw = localStorage.getItem(settingsKey);
      if(!raw) return;
      const x = JSON.parse(raw);
      Object.assign(state, x);
      // lastDocId/lastTitle ã¯ stateã§ã¯ãªãå¤–å´ã§ç®¡ç†
      if(x.lastDocId) lastDocId = x.lastDocId;
      if(x.lastTitle) lastTitle = x.lastTitle;
    }catch(e){}
  }

  function refreshNowReading(){
    nowReading.textContent = lastTitle ? lastTitle : "æœªèª­";
  }

  // ---- Aozora txt -> HTMLï¼ˆæœ€ä½é™ï¼‰
  function stripAozoraHeader(text){
    const lines = text.replace(/\r\n/g,"\n").split("\n");
    const ruleIdx = [];
    for(let i=0;i<lines.length;i++){
      if(/^[-ãƒ¼]{10,}$/.test(lines[i].trim())) ruleIdx.push(i);
      if(ruleIdx.length>=2) break;
    }
    if(ruleIdx.length>=2){
      return lines.slice(ruleIdx[1]+1).join("\n");
    }
    return text;
  }

  function aozoraToHtml(txt){
    let t = stripAozoraHeader(txt);
    t = escapeHtml(t);

    // æ³¨è¨˜ï¼ˆâ€»ï¼»ï¼ƒ...ï¼½ï¼‰ã‚’è»½ãé™¤å»
    t = t.replace(/â€»ï¼»ï¼ƒ[^ï¼½]*ï¼½/g, "");
    t = t.replace(/ï¼»ï¼ƒ[^ï¼½]*ï¼½/g, "");

    // å¼·èª¿ï¼ˆã€Šã€Šå¼·èª¿ã€‹ã€‹ï¼‰
    t = t.replace(/ã€Šã€Š(.+?)ã€‹ã€‹/g, "<strong>$1</strong>");

    // ãƒ«ãƒ“ï¼šï½œåŸºåº•ã€Šãƒ«ãƒ“ã€‹
    t = t.replace(/ï½œ([^ã€Š\n]+)ã€Š([^ã€‹\n]+)ã€‹/g, `<ruby><rb>$1</rb><rt>$2</rt></ruby>`);

    // ãƒãƒ¼ç„¡ã—ç°¡æ˜“ï¼šæ¼¢å­—åˆ—ã€Šã‚ˆã¿ã€‹
    t = t.replace(/([ä¸€-é¾¥ã€…ã€†ãƒµãƒ¶]{1,20})ã€Š([^ã€‹\n]+)ã€‹/g, `<ruby><rb>$1</rb><rt>$2</rt></ruby>`);

    const blocks = t.split(/\n{2,}/).map(b => b.trim()).filter(Boolean);
    return blocks.map(b => `<p>${b.replace(/\n/g,"<br>")}</p>`).join("\n");
  }

  function docIdFromMeta(meta){
    return `${meta.name}__${meta.size}__${meta.lastModified}`;
  }

  function getScrollRatio(){
    const max = scroller.scrollHeight - scroller.clientHeight;
    return max > 0 ? (scroller.scrollTop / max) : 0;
  }
  function setScrollRatio(ratio){
    const max = scroller.scrollHeight - scroller.clientHeight;
    scroller.scrollTop = Math.floor(max * clamp(ratio, 0, 1));
  }

  function decodeFromBuffer(buf, encoding){
    // Safariã§TextDecoder('shift-jis')ãŒåŠ¹ã‹ãªã„å ´åˆã‚‚ã‚ã‚‹ã®ã§ã€readAsTextå„ªå…ˆã§ã¯ãªã
    // ã€Œèª­ã¿è¾¼ã¿æ™‚ã«å–ã£ãŸãƒ†ã‚­ã‚¹ãƒˆã€ã§ã¯ãªãã€Œãƒã‚¤ãƒˆåˆ—ã€ã‹ã‚‰æ¯å›ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã€‚
    // TextDecoder ãŒãƒ€ãƒ¡ãªã‚‰ä¾‹å¤–ã«ãªã‚‹ â†’ UIã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    const dec = new TextDecoder(encoding);
    return dec.decode(buf);
  }

  function renderText(text){
    const headLines = String(text).replace(/\r\n/g,"\n").split("\n").slice(0,20).map(s=>s.trim()).filter(Boolean);
    const title = headLines[0] || (lastFileMeta?.name ?? "Untitled");
    const author = headLines[1] && headLines[1] !== title ? headLines[1] : "";

    lastTitle = title;
    refreshNowReading();

    const body = aozoraToHtml(String(text));
    paper.innerHTML = `
      <div class="title">${escapeHtml(title)}</div>
      ${author ? `<div class="author">${escapeHtml(author)}</div>` : ""}
      <hr/>
      ${body}
    `;
  }

  function showError(err){
    paper.innerHTML = `<div class="empty">
      <div style="font-weight:700;margin-bottom:6px;">èª­ã¿è¾¼ã¿å¤±æ•—</div>
      <div class="hint">â‘ ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚ã†ä¸€åº¦ï¼ˆShift_JIS / UTF-8ï¼‰</div>
      <div class="hint">â‘¡ã€Œèª­ã¿è¾¼ã¿ãƒªã‚»ãƒƒãƒˆã€â†’ãƒ•ã‚¡ã‚¤ãƒ«é¸ã³ç›´ã—</div>
      <div class="hint" style="margin-top:10px;">è©³ç´°: ${escapeHtml(String(err))}</div>
    </div>`;
  }

  async function openFile(file){
    // ãƒã‚¤ãƒˆåˆ—ã¨ã—ã¦ä¿æŒï¼ˆå¾Œã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ï¼‰
    lastFileBuf = await file.arrayBuffer();
    lastFileMeta = { name:file.name, size:file.size, lastModified:file.lastModified };
    lastDocId = docIdFromMeta(lastFileMeta);

    // ã¾ãšç¾åœ¨ã®è¨­å®šã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ãƒ‡ã‚³ãƒ¼ãƒ‰
    try{
      const text = decodeFromBuffer(lastFileBuf, encodingSel.value);
      renderText(text);
    }catch(err){
      showError(err);
      return;
    }

    // å‰å›ä½ç½®ã¸å¾©å¸°ï¼ˆæ¨ªæ›¸ãã®ã¿ï¼‰
    if(document.body.dataset.writing !== "vertical"){
      const posKey = "bluesongs_reader_pos_" + lastDocId;
      const raw = localStorage.getItem(posKey);
      requestAnimationFrame(() => {
        if(raw){
          const ratio = parseFloat(raw);
          if(!Number.isNaN(ratio)) setScrollRatio(ratio);
          else scroller.scrollTop = 0;
        } else {
          scroller.scrollTop = 0;
        }
      });
    } else {
      // ç¸¦æ›¸ãã¯æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã®ã§ã€ã¨ã‚Šã‚ãˆãšå…ˆé ­ã¸
      scroller.scrollLeft = 0;
    }

    saveSettings();

    // â˜…èª­æ›¸ã«é›†ä¸­ï¼šèª­ã¿è¾¼ã¿å¾Œã¯è‡ªå‹•ã§è¨­å®šã‚’é–‰ã˜ã‚‹
    controls.open = false;
    updateOpenHint();
  }

  function rerenderWithCurrentEncoding(){
    if(!lastFileBuf) return; // ã¾ã ä½•ã‚‚èª­ã¿è¾¼ã‚“ã§ãªã„
    try{
      const text = decodeFromBuffer(lastFileBuf, encodingSel.value);
      renderText(text);
      // å†ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸã‚‰å…ˆé ­ã¸ï¼ˆæ–‡å­—åŒ–ã‘ã‚’ç›´ã™ç”¨é€”ãªã®ã§ï¼‰
      if(document.body.dataset.writing === "vertical"){
        scroller.scrollLeft = 0;
      } else {
        scroller.scrollTop = 0;
      }
      saveSettings();
    }catch(err){
      showError(err);
    }
  }

  function resetLoad(){
    lastFileBuf = null;
    lastFileMeta = null;
    lastDocId = null;
    lastTitle = null;
    refreshNowReading();
    fileInput.value = ""; // åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã³ç›´ã›ã‚‹ã‚ˆã†ã«
    scroller.scrollTop = 0;
    scroller.scrollLeft = 0;

    paper.innerHTML = `
      <div class="empty">
        <div style="font-weight:700; margin-bottom:6px;">Bluesongs Reader</div>
        <div>ã€Œè¨­å®šã€â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶ã¨ã€é’ç©ºæ–‡åº«ã®ãƒ«ãƒ“ä»˜ããƒ†ã‚­ã‚¹ãƒˆã‚’èª­æ›¸ã‚¢ãƒ—ãƒªã£ã½ãèª­ã‚ã‚‹ã‚ˆã€‚</div>
        <div style="margin-top:10px;" class="hint">ãƒ«ãƒ“è¨˜æ³•ä¾‹ï¼šï½œæ¼¢å­—ã€Šã‹ã‚“ã˜ã€‹</div>
      </div>
    `;
    saveSettings();
  }

  // ---- controls
  el("smaller").onclick = () => { state.fontSize = clamp(state.fontSize - 1, 14, 30); setCssVars(); saveSettings(); };
  el("bigger").onclick  = () => { state.fontSize = clamp(state.fontSize + 1, 14, 30); setCssVars(); saveSettings(); };

  el("lhDown").onclick  = () => { state.lineHeight = clamp((parseFloat(state.lineHeight) - 0.1), 1.2, 2.6).toFixed(2); setCssVars(); saveSettings(); };
  el("lhUp").onclick    = () => { state.lineHeight = clamp((parseFloat(state.lineHeight) + 0.1), 1.2, 2.6).toFixed(2); setCssVars(); saveSettings(); };

  el("theme").onclick = () => {
    state.theme = (state.theme === "light") ? "dark" : "light";
    applyTheme(); saveSettings();
  };
  el("writing").onclick = () => {
    state.writing = (state.writing === "horizontal") ? "vertical" : "horizontal";
    applyWriting(); saveSettings();

    // ç¸¦æ¨ªåˆ‡ã‚Šæ›¿ãˆæ™‚ã¯è¦‹å¤±ã„é˜²æ­¢ã§å…ˆé ­ã¸
    if(state.writing === "vertical"){
      scroller.scrollLeft = 0;
    } else {
      scroller.scrollTop = 0;
    }
  };

  el("resetView").onclick = () => {
    state.theme = "light";
    state.writing = "horizontal";
    state.fontSize = 18;
    state.lineHeight = 1.9;
    state.font = "mincho";
    applyTheme();
    applyWriting();
    setCssVars();
    fontSel.value = state.font;
    saveSettings();
  };

  el("resetLoad").onclick = () => resetLoad();

  fileInput.addEventListener("change", async (e) => {
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    await openFile(file);
  });

  // â˜…èª­ã¿è¾¼ã¿å¾Œã‚‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã§ã€Œå³å†ãƒ‡ã‚³ãƒ¼ãƒ‰ã€ã§ãã‚‹
  encodingSel.addEventListener("change", () => {
    state.encoding = encodingSel.value;
    saveSettings();
    rerenderWithCurrentEncoding();
  });

  // ãƒ•ã‚©ãƒ³ãƒˆé¸æŠ
  fontSel.addEventListener("change", () => {
    state.font = fontSel.value;
    setCssVars();
    saveSettings();
  });

  // èª­æ›¸ä½ç½®ä¿å­˜ï¼ˆæ¨ªæ›¸ãï¼šç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ¯”ï¼‰
  scroller.addEventListener("scroll", () => {
    if(!lastDocId) return;
    if(document.body.dataset.writing === "vertical") return; // ç¸¦æ›¸ãã¯ä»Šå›ã¯ä¿å­˜ã—ãªã„ï¼ˆè¦æœ›ãŒã‚ã‚Œã°å¯¾å¿œï¼‰
    const ratio = getScrollRatio();
    const posKey = "bluesongs_reader_pos_" + lastDocId;
    localStorage.setItem(posKey, String(clamp(ratio, 0, 1)));
  }, { passive:true });

  // æŠ˜ã‚ŠãŸãŸã¿çŸ¢å°
  function updateOpenHint(){
    openHint.textContent = controls.open ? "â–²" : "â–¼";
  }
  controls.addEventListener("toggle", updateOpenHint);

  // init
  loadSettings();
  applyTheme();
  setCssVars();
  // ä¿å­˜å€¤ãŒã‚ã‚Œã°ãã‚Œã‚’å„ªå…ˆ
  encodingSel.value = state.encoding || "shift-jis";
  fontSel.value = state.font || "mincho";
  applyWriting();

  refreshNowReading();
  updateOpenHint();

  // â˜…èª­æ›¸ã«é›†ä¸­ï¼šåˆæœŸã¯é–‰ã˜ã‚‹
  controls.open = false;

  // ç”»é¢å›è»¢ãªã©ã§ç¸¦æ›¸ãé«˜ã•å†è¨ˆç®—
  window.addEventListener("resize", () => {
    if(state.writing === "vertical") applyWriting();
  });
})();
</script>
</body>
</html>
